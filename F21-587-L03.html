
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>CEN 587: Lecture 03 &#8212; CEN 587 Fall 2022</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CEN 587: Recitation 01" href="F21-587-R01-Solution.html" />
    <link rel="prev" title="CEN 587: Lecture 02" href="F21-587-L02.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/JQB.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CEN 587 Fall 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="F21-587-L01.html">
   Lecture 01
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="F21-587-L02.html">
   CEN 587: Lecture 02
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   CEN 587: Lecture 03
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="F21-587-R01-Solution.html">
   CEN 587: Recitation 01
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jqbond/2022CEN587/main?urlpath=tree/docs/F21-587-L03.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jqbond/2022CEN587"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jqbond/2022CEN587/issues/new?title=Issue%20on%20page%20%2FF21-587-L03.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/F21-587-L03.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>CEN 587: Lecture 03</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="cen-587-lecture-03">
<h1>CEN 587: Lecture 03<a class="headerlink" href="#cen-587-lecture-03" title="Permalink to this headline">#</a></h1>
<p>This lecture covers the basic ideas behind numerical methods for solving algebraic equations and ordinary differential equations.</p>
<p>For more detail on these concepts and how they are implemented in Python, please reference <strong>Supplements 08 - 12</strong>.</p>
<p><span style="font-family:Times New Roman; font-size:1.5em;"><strong>Numerical Methods</strong></span></p>
<p>Although your math and introductory engineering courses generally present a lot of problems that you were able to solve by hand using pencil-and-paper and, at most, a calculator, this is not generally the case in engineering practice.</p>
<p>We frequently have to solve equations or sets of equations that have no tractable, closed-form analytical solution (pencil-and-paper solution).  They are either impossible to solve by hand, or just very tedious.  In these cases, we have to rely on numerical methods, which provide an approximation of the true solution.</p>
<p>We will cover the main ideas behind them here.  We will use numerical methods extensively this semester, so I’ll introduce a few of the key tools for solving various types of equations in this notebook, and then we’ll get a lot of practice with them for the rest of the semester.</p>
<p>We will start with <strong>algebraic equations</strong>, and then we will cover <strong>ordinary differential equations (ODEs)</strong>.  Any special cases outside of these, we’ll cover as the semester progresses.</p>
<p><span style="font-family:Times New Roman; font-size:1.5em;"><strong>Solving Algebraic Equations</strong></span></p>
<p>Let’s imagine we have an algebraic equation that we want to solve.  In this case, we’ll consider a simple function:</p>
<div class="math notranslate nohighlight">
\[f(x) = x^2 - 10x - 25\]</div>
<p>And we want to find the root of that function, i.e., where it is equal to zero.  So, we’re solving this equation:</p>
<div class="math notranslate nohighlight">
\[0 = x^2 - 10x - 25\]</div>
<p>Now, this one is actually pretty easy to solve. I would just use the quadratic formula if I needed an exact solution.</p>
<div class="math notranslate nohighlight">
\[ x = -b \pm \frac{\sqrt{\left(b^2 - 4ac\right)}}{2a}\]</div>
<p>If we do that, we find that there are two solutions to this equation (two roots of the function):</p>
<div class="amsmath math notranslate nohighlight" id="equation-3249e515-e7f7-49e6-be01-8eabc7863f11">
<span class="eqno">(22)<a class="headerlink" href="#equation-3249e515-e7f7-49e6-be01-8eabc7863f11" title="Permalink to this equation">#</a></span>\[\begin{align}
    x &amp;= 12.07107 \\
    x &amp;= -2.07107
\end{align}\]</div>
<p>But what if we had no idea how to solve the problem?  There are a number of things we might try.  I always like graphing the function – for univariate problems, this is both easy and useful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">25</span>
<span class="n">xplot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xplot</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.LineCollection at 0x1857c5a6580&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_3_1.png" src="_images/F21-587-L03_3_1.png" />
</div>
</div>
<p>From this, we can plainly see there is one root near -2, and there is another root near 12, which is consistent with our quadratic formula solution.</p>
<p>Graphing isn’t the most precise method, but it allows us to very quickly identify the rough location of roots and solutions to various functions.</p>
<p>Beyond this, we generally have to rely on iterative methods, where we guess a likely solution, check the answer to see how close we are to the desired value, and then change our guess, hopefully moving toward the solution as we change our guesses.</p>
<p>The most basic example is an iterative guess-and-check strategy.  We literally make a guess and keep changing it until we get close enough to our solution.  “Close enough” is the tolerance on our problem solution, and it depends on the level of precision we need in a particular problem.</p>
<p><strong>Brute Force: Guess and Check</strong></p>
<p>In class, I demonstrated the basic, simple logic of a guess and check strategy.  That is implemented in the cell below, where I just repeatedly pass values of x to our function f(x) until it returns a value that is sufficiently close to zero for my satisfaction…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">))</span>  <span class="c1">#gives 175</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>   <span class="c1">#gives -25.  There is at least one root between -10 and 10 since I crossed the x-axis.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">))</span>    <span class="c1">#gives 50....There is at least one root between -10 and -5 sice I crossed x again</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">))</span>    <span class="c1">#gives 94....that move was away from the root</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span>    <span class="c1">#gives 14....relative to -5, that moves me toward the root</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c1">#gives -14...the root is somewhere between -1 and -3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>    <span class="c1">#gives -1...close, but not quite there</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">))</span>  <span class="c1">#gives 6.25...too far</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mf">2.1</span><span class="p">))</span>  <span class="c1">#gives 0.4...root must be between -2 and -2.1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mf">2.05</span><span class="p">))</span> <span class="c1">#gives -.29...root is between -2.05 and -2.1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mf">2.075</span><span class="p">))</span> <span class="c1">#gives 0.0556...root must be between -2.05 and -2.075</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">-</span><span class="mf">2.07</span><span class="p">))</span>  <span class="c1">#gives -0.015...close enough.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>175
-25
50
94
14
-14
-1
6.25
0.41000000000000014
-0.29749999999999943
0.05562499999999915
-0.015100000000000335
</pre></div>
</div>
</div>
</div>
<p>So, you can see that guess and check is a pretty inefficient way to do this.  It requires me to inspect each solution and make decisions about my next guess.  Although I can probably get this to work for a simple univarate funtion like f(x) above, it is almost impossible to use guess and check to solve a system of equations numerically.  In these cases, we’ll use formal numerical algorithms to solve algebraic equations.  There are numerous options, many of which are already built into Python, Matlab, Excel, etc.</p>
<p><strong>Newton-Raphson method</strong></p>
<p>As an example, we’ll implement a Newton-Raphson iteration to solve this problem.  The Newton-Raphson iteration is much better than what I did above because it uses information about both the function value and its derivative to update guesses automatically.  The formula for the Newton-Raphson iteration is this:</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i - \frac{f(x_i)}{f^\prime(x_i)}\]</div>
<p>We simply make an initial guess, <span class="math notranslate nohighlight">\(x_i\)</span>, then we update that guess by subtracting the ratio of the function value at <span class="math notranslate nohighlight">\(x_i\)</span>, <span class="math notranslate nohighlight">\(f(x_i)\)</span>, to its derivative at <span class="math notranslate nohighlight">\(x_i\)</span>, <span class="math notranslate nohighlight">\(f^\prime(x_i)\)</span>.</p>
<p>I run this iteratively in the cell below using a while loop; this is the same as clicking and dragging to autofill in Excel, which is what I did in class.  You can see how quickly it converges for this simple example.  This is much, much better than a simple guess and check strategy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">25</span>
<span class="n">df</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>

<span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-4.1666666667 175
-2.3106060606 34.0277777778
-2.0749921495 3.4449609734
-2.0710689002 0.0555139151
-2.0710678119 1.53919e-05
</pre></div>
</div>
</div>
</div>
<p><strong>Numerical Methods for Alebraic Equations can be difficult…</strong></p>
<p>Although a Newton-Raphson iteration is very useful, it isn’t always guaranteed to converge.  In general, you’ll find this is true of algebraic solutions.  They can be flaky, and they are usually very sensitive to the initial guess that we make for the solution.  As the equations become increasingly nonlinear and difficult to solve, we will find we need very good initial guesses in order to get numerical methods to converge for algebraic equations.</p>
<p>As an example, let’s consider the more difficult function:</p>
<div class="math notranslate nohighlight">
\[g(x) = -0.74 + 0.765x + 1.1x^2 - 3.55x^3\]</div>
<p>We’ll graph it and then run a Newton-Raphson iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.74</span>  <span class="o">+</span> <span class="mf">0.765</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.55</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="n">dg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.765</span> <span class="o">+</span> <span class="mf">2.2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="mf">3.55</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">xspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xspan</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">xspan</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.LineCollection at 0x1857c6a5bb0&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_9_1.png" src="_images/F21-587-L03_9_1.png" />
</div>
</div>
<p>From this, we can see one root at about -0.6. Let’s try to find it with a Newton-Raphson iteration. We’ll start with an initial guess of -0.5 and see what happens…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">dg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.6346955796 -0.40375
-0.609247652 0.1252435048
-0.6081366095 0.0050312899
-0.6081345343 9.3625e-06
</pre></div>
</div>
</div>
</div>
<p>We see it converges to the root easily…now let’s try an initial guess of 5/9.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x = 5/9</span>
<span class="c1"># y = g(x)</span>

<span class="c1"># while abs(y) &gt; 1e-3:</span>
<span class="c1">#     y = g(x)</span>
<span class="c1">#     x = x - g(x)/dg(x)</span>
<span class="c1">#     print(round(x, 10), round(y, 10))</span>
</pre></div>
</div>
</div>
</div>
<p>There, we wind up in an infinite loop because the NR iteration hits an unstable cycle.  The point of this illustration is that when you’re solving algebraic equations with numerical methods, beware that they will generally be very sensitive to the initial guess that you make.</p>
<p><strong>Better tools are available in Python, Excel, and Matlab</strong></p>
<p>In general, we’ll just use default numerical methods packages in whatever software we’re using instead of writing iteration codes ourselvs.  Under the hood, it’s basically the same thing, although the built in tools are generally more robust against issues like we encounter above.  In class, I demonstrated using Solver in Excel.  If you’re in Python, the equivalent tools are found in the <em>optimize</em> module from the Scipy Package.  See Supplement 08 for details about how to use it, and we’ll also cover it in recitation during Week 02.  But here’s how it works in practice.  There are many solvers available in scipy.opimtize.  The example below using “newton”, which here, I think is using a secant method to find the root of the above function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span> <span class="k">as</span> <span class="n">opt</span>

<span class="nb">print</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-2.071067811865486
-0.6081345342894497
</pre></div>
</div>
</div>
</div>
<p><strong>Numerical Methods for Systems of Equation</strong></p>
<p>In class, I showed how you can use solver with an objective function and constraints to solve a system of equations, e.g.:</p>
<div class="amsmath math notranslate nohighlight" id="equation-188421b7-fcd3-4bcf-a663-36c156bd175e">
<span class="eqno">(23)<a class="headerlink" href="#equation-188421b7-fcd3-4bcf-a663-36c156bd175e" title="Permalink to this equation">#</a></span>\[\begin{align}
    0 &amp;= x^2 - 10x - 25y + 17 \\
    0 &amp;= y^2  - 36x
\end{align}\]</div>
<p>To solve this system, we create a vector function and solve using optimize.root (See Supplement 11). We’ll also cover in Recitation during Week 02.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eqns</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">eq1</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span><span class="mi">25</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">17</span>
    <span class="n">eq2</span> <span class="o">=</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">36</span><span class="o">*</span><span class="n">x</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">eq1</span><span class="p">,</span> <span class="n">eq2</span><span class="p">]</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">eqns</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.01265418 0.67494473]
</pre></div>
</div>
</div>
</div>
<p><strong>Numerical Methods for Ordinary Differential Equations</strong></p>
<p>In class, we considered how one might solve an initial value problem in cases where it isn’t clear how to integrate the differential equation by hand.  We demonstrated the methods by considering a simple initial value problem:</p>
<div class="math notranslate nohighlight">
\[\frac{dx}{dt} = -x\]</div>
<p>Where <span class="math notranslate nohighlight">\(x = 10\)</span> at <span class="math notranslate nohighlight">\(t = 0\)</span>.</p>
<p>We would like to know the value of <span class="math notranslate nohighlight">\(x\)</span> at <span class="math notranslate nohighlight">\(t = 4\)</span>.  In this case, it is a first order ODE, and we can easily separate variables and integrate by hand:</p>
<div class="math notranslate nohighlight">
\[\int_{x_0}^x\frac{1}{x^\prime} dx^\prime = - \int_0^t dt^\prime\]</div>
<p>The integral on the left is a natural logarithm, so the solution of a first order problem like this is always an exponential function of time:</p>
<div class="math notranslate nohighlight">
\[x(t) = x_0\exp(-t)\]</div>
<p>Based on that solution, we can create a function and plot it to show the <strong>true</strong> behavior of x as a function of t.  Then, we’ll try to approximate that behavior using a numerical integration of that initial value problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">xtrue</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">xtrue</span><span class="p">(</span><span class="n">tspan</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 4.0)
</pre></div>
</div>
<img alt="_images/F21-587-L03_19_1.png" src="_images/F21-587-L03_19_1.png" />
</div>
</div>
<p>Now that our function x(t) is defined, we can easily use it to evaluate x at t = 4; we find that it is equal to 0.183</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtrue</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1831563888873418
</pre></div>
</div>
</div>
</div>
<p>Now we’ll consider the case where we don’t actually know the analytical solution, and we need to approximate it using a numerical method.  In this case, we’ll use an Euler step, but the general concept here is the same as that used in more advanced methods:  we use information about the derivative of a function at the current value of that function to estimate where the function will be at some point in the future (a future time or a future position).</p>
<p>This is based on the idea that the derivative of a function tells us the change in dependent variable that occurs when we change the dependent variable, i.e., for this function:</p>
<div class="math notranslate nohighlight">
\[\frac{dx}{dt} = m\]</div>
<p>Where m is the slope of the function x(t) at a given point in time.  We don’t know what the function is, but we do know what its derivative is:</p>
<div class="math notranslate nohighlight">
\[\frac{dx}{dt} = -x\]</div>
<p>We can <strong>approximate</strong> a derivative using discrete (i.e., non-differential) changes in x and t, similar to what we did when we first learned about a slope as “rise over run”.</p>
<div class="math notranslate nohighlight">
\[m \approx \frac{\Delta x}{\Delta t}\]</div>
<p>We can discretize that to describe the change in x and t in terms of their current state (position <span class="math notranslate nohighlight">\(i\)</span>) and their state at one step in the future (position <span class="math notranslate nohighlight">\(i+1\)</span>):</p>
<div class="math notranslate nohighlight">
\[m_i = \frac{(x_{i+1} - x_i)}{(t_{i+1} - t_i)}\]</div>
<p>In other words, if we know the slope, we can make a small step in the independent variable (<span class="math notranslate nohighlight">\(\Delta t = t_{i+1} - t_i\)</span>) and estimate where the dependent variable ends up after we make the step:</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i + m_i\Delta t\]</div>
<p>In this specific example, we know that <span class="math notranslate nohighlight">\(m = -x\)</span>, so:</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i - x_i\Delta t\]</div>
<p>For consistency with the Runge-Kutta notation I use below, I’m going to call that time step “h”, giving:</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i - hx_i\]</div>
<p>For the Euler method.</p>
<p>That is all we need to write an iterative loop to solve this using a numerical method to approximate x(t).  This is implemented with for loop below, which I do by specifying the number of steps the solver will take and integrating to a time of 4 units, no matter how many steps I’ve made.  That is, I adjust the step size in response to the number of steps I want to take.  As I take more steps, the step size gets smaller. We’ll start with 5 steps for illustration purposes and go from there. We start the iteration at the start of our initial value problem, i.e., at t = 0, x = 10…and we’ll step forward in time until we reach t = 4.  We’ll plot the result to see how well it compares with the true solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">tmax</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">h</span>      <span class="o">=</span> <span class="n">tmax</span><span class="o">/</span><span class="n">nsteps</span>
<span class="n">t</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.00</span><span class="p">]</span> <span class="c1">#I&#39;m doing this as a list to store all values of time.</span>
<span class="n">x</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">10.00</span><span class="p">]</span> <span class="c1">#Likewise, I want to store all values of x for plotting.</span>

<span class="c1">#We&#39;ll append updated values to t and x on each pass through the loop</span>
<span class="c1">#I&#39;m using lists because they are easy to append in place</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At t = 4 with </span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s1"> steps and a step size of </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1"> the Euler method predits that x = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">, and the true value is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">xtrue</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">xtrue</span><span class="p">(</span><span class="n">tspan</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical Solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At t = 4 with 5 steps and a step size of 0.8:
 the Euler method predits that x = 0.0032, and the true value is 0.18316
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1857d113c10&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_23_2.png" src="_images/F21-587-L03_23_2.png" />
</div>
</div>
<p>You can see that Euler does a pretty bad job here; that is because we are making large steps and assuming that the derivative value doesn’t change over the span of that step, which clearly isn’t true when you consider that m = -x:  as x changes, the slope has to change.  So this is a really rough approximation, and we wont’ see good agreement unless we take a lot of steps (see below).  Feel free to progressively adjust the step size to get a feel for how many steps (and how small each step needs to be) to get even reasonable accuracy with an Euler method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">tmax</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">h</span>      <span class="o">=</span> <span class="n">tmax</span><span class="o">/</span><span class="n">nsteps</span>
<span class="n">t</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.00</span><span class="p">]</span> <span class="c1">#I&#39;m doing this as a list to store all values of time.</span>
<span class="n">x</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">10.00</span><span class="p">]</span> <span class="c1">#Likewise, I want to store all values of x for plotting.</span>

<span class="c1">#We&#39;ll append updated values to t and x on each pass through the loop</span>
<span class="c1">#I&#39;m using lists because they are easy to append in place</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At t = 4 with </span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s1"> steps and a step size of </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1"> the Euler method predits that x = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">, and the true value is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">xtrue</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">xtrue</span><span class="p">(</span><span class="n">tspan</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical Solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At t = 4 with 700 steps and a step size of 0.00571429:
 the Euler method predits that x = 0.18107, and the true value is 0.18316
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1857d1a9250&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_25_2.png" src="_images/F21-587-L03_25_2.png" />
</div>
</div>
<p><strong>Higher Order Methods</strong></p>
<p>There are far more accurate methods for numerical integration.  Many, many methods, actually.  We’ll usually be able to use the classic 4th order Runge Kutta method in this class.  Occasionally, we may run into a stiff ODE system that will require us to use a stiff solver, but we’ll cross that bridge when we come to it.</p>
<p>An explict 4th order Runge Kutta method is a fancy adaptation of the Euler method that is able to better anticipate how the derivative of the function will change across the span of the step.  This makes it much, much more accurate, and we’ll find that we can get almost analytical precision with only a few steps.  It looks much more complicated, but the principle is the same.  We are using the current value of the function and the derivative function to estimate where the function will be at some point in the future.</p>
<p>If you want to read a little more about the 4th order Runge-Kutta method, it’s worth a quick look at least at Wikipedia, though you can get a more thorough treatment in a numerical methods book.</p>
<p>https://en.wikipedia.org/wiki/Runge-Kutta_methods</p>
<p>If you skim that page, you’ll see the equations I used to develop the iteration scheme in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">tmax</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">h</span>      <span class="o">=</span> <span class="n">tmax</span><span class="o">/</span><span class="n">nsteps</span>
<span class="n">xRK</span>    <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">]</span> <span class="c1">#RK values</span>
<span class="n">tRK</span>    <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>  <span class="c1">#RK values</span>
<span class="n">t</span>      <span class="o">=</span> <span class="p">[</span><span class="mf">0.00</span><span class="p">]</span> <span class="c1">#Euler values</span>
<span class="n">x</span>      <span class="o">=</span> <span class="p">[</span><span class="mf">10.00</span><span class="p">]</span> <span class="c1">#Euler values</span>

<span class="c1">#Euler method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>

<span class="c1">#RK Method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="n">dxdt</span>  <span class="o">=</span> <span class="o">-</span><span class="n">xRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1">#compute derivative, dx/dt @ x[i], t[i]</span>
    <span class="n">k1</span>    <span class="o">=</span>  <span class="n">dxdt</span>    <span class="c1">#RK parameter &quot;k1[i]&quot; is equal to derivative &quot;dxdt[i] </span>
    <span class="n">k2</span>    <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">xRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span> <span class="c1">#RK parameter &quot;k2[i]&quot; is a more complex function of both x and dxdt</span>
    <span class="n">k3</span>    <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">xRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="p">)</span> <span class="c1">#RK parameter &quot;k3[i]&quot; is a more complex function of both x and dxdt</span>
    <span class="n">k4</span>    <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">xRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k3</span><span class="p">);</span>  <span class="c1">#RK parameter &quot;k4[i]&quot; is a more complex function of both x and dxdt</span>
    <span class="n">xRK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">))</span> <span class="c1">#RK parameters k1 to k4 are used to predict change in x over time step h.  This equation gives the value of x[i+1].</span>
    <span class="n">tRK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tRK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="c1">#This steps the time forward to t[i+1].</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At t = 4 with </span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s1"> steps and a step size of </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1"> the RK method predits that x = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">xRK</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">, and the true value is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">xtrue</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler Step&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tRK</span><span class="p">,</span> <span class="n">xRK</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Runge Kutta&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">xtrue</span><span class="p">(</span><span class="n">tspan</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical Solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At t = 4 with 5 steps and a step size of 0.8:
 the RK method predits that x = 0.18811, and the true value is 0.18316
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1857d1f0b20&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_27_2.png" src="_images/F21-587-L03_27_2.png" />
</div>
</div>
<p>As with the Algebraic methods above, we really don’t want to write our own integration algorithms.  There is much better support already built into Python, Matlab, etc.  The numerical methods packages for ODE solutions are in the scipy package, specifically the solve_ivp module.  It is relatively easy to use, we just write a funciton that calculates our derivative, give it initial values and an integration span, and it does the rest for us.  We’ll cover it in detail in recitation, and I also have a lot of examples in Supplement 12, but the basic approach is given in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span> <span class="k">as</span> <span class="n">ivp</span>

<span class="k">def</span> <span class="nf">D</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>  <span class="c1">#function of form f(independent variable, dependent variable)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="c1">#this is just calculating my derivative and returning it.</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At t = 4 w:</span><span class="se">\n</span><span class="s1"> default scipy.integrate.solve_ivp predits that x = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">, and the true value is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">xtrue</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler Step&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tRK</span><span class="p">,</span> <span class="n">xRK</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Runge Kutta&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Scipy&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">xtrue</span><span class="p">(</span><span class="n">tspan</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical Solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At t = 4 w:
 default scipy.integrate.solve_ivp predits that x = 0.18355, and the true value is 0.18316
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1857e307af0&gt;
</pre></div>
</div>
<img alt="_images/F21-587-L03_29_2.png" src="_images/F21-587-L03_29_2.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="F21-587-L02.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">CEN 587: Lecture 02</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="F21-587-R01-Solution.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CEN 587: Recitation 01</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By JQB<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>